<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Academic Profile</title>
  <meta name="description" content="Dynamic academic site auto-synced with Google Scholar." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Inter, sans-serif; background: #f9fafb; color: #111; }
    .glass { background: rgba(255,255,255,0.8); backdrop-filter: blur(8px); }
    summary { cursor: pointer; color: #4f46e5; font-weight: 500; }
    summary:hover { text-decoration: underline; }
    @media (prefers-color-scheme: dark){
      body { background: #0b101b; color: #e6e9ef; }
      .glass { background: rgba(20,25,35,0.8); }
    }
  </style>
</head>
<body class="min-h-screen">
  <header class="sticky top-0 bg-white/80 dark:bg-slate-950/70 border-b border-black/10 dark:border-white/10 backdrop-blur">
    <div class="max-w-6xl mx-auto flex justify-between items-center px-4 py-3">
      <h1 id="hero-name" class="text-xl font-bold"></h1>
      <a id="scholar-link" target="_blank" class="text-indigo-600 hover:underline">Google Scholar</a>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <section class="mb-10">
      <h2 class="text-2xl font-bold mb-4">Publications</h2>
      <div id="pub-list" class="grid gap-4"></div>
    </section>
  </main>

  <footer class="text-center opacity-70 py-10 border-t border-black/5 dark:border-white/10">
    Auto-synced from Google Scholar Â· Hosted on GitHub Pages
  </footer>

  <script>
    const CONFIG = {
      name: "Your Name",
      scholarUserId: "GOCSqdUAAAAJ" // replace with your Google Scholar ID
    };
    document.getElementById("hero-name").textContent = CONFIG.name;
    document.getElementById("scholar-link").href = 
      `https://scholar.google.com/citations?user=${CONFIG.scholarUserId}&hl=en`;

    async function loadPublications() {
      try {
        const res = await fetch("publications.json?nocache=" + Date.now());
        const data = await res.json();
        const list = document.getElementById("pub-list");
        list.innerHTML = "";

        // Sort by year descending
        data.items.sort((a,b)=>(b.year||0)-(a.year||0));

        for (const p of data.items) {
          const div = document.createElement("div");
          div.className = "glass p-5 rounded-xl";

          // Clean up data
          const authors = (p.authors || []).join(", ");
          let venueText = p.venue || "";
          let yearText = p.year || "";
          // remove duplicate year from venue if exists
          venueText = venueText.replace(new RegExp("\\b" + yearText + "\\b", "g"), "").replace(/,\\s*,/g, ",").trim().replace(/,$/, "");

          // Inline venue + year formatting
          let venueLine = "";
          if (venueText && yearText)
            venueLine = `<div class='italic opacity-80'>${venueText} (${yearText})</div>`;
          else if (venueText)
            venueLine = `<div class='italic opacity-80'>${venueText}</div>`;
          else if (yearText)
            venueLine = `<div class='italic opacity-80'>(${yearText})</div>`;

          // Abstract section (collapsible)
          const abstract = p.abstract ? `
            <details class="mt-3">
              <summary>Show abstract</summary>
              <p class="mt-2 text-sm opacity-90 leading-relaxed">${p.abstract}</p>
            </details>` : "";

          // Build card
          div.innerHTML = `
            <h3 class="font-semibold text-lg mb-1">${p.title}</h3>
            <div class="opacity-90">${authors}</div>
            ${venueLine}
            ${abstract}
          `;
          list.appendChild(div);
        }
      } catch (err) {
        console.error("Error loading publications.json", err);
        document.getElementById("pub-list").innerHTML =
          "<p class='opacity-70'>Failed to load publications. Please check publications.json.</p>";
      }
    }

    loadPublications();
  </script>
</body>
</html>
